\chapter{Optimal Anchor Node Placements}
\label{chap:placments}
\section{Measuring Location Error}
Before searching for the best anchor node placement we must first define what \emph{best} means, in terms of location error.  First of all, location error is the distance between the real and calculated position of each node, measured as a factor of radio radius (or range).  Since this study addresses range-free networks, and thus relies solely on network connectivity, the actual units of distance do not matter for general study.  What is important to the protocol is how many other nodes in the network fall within the radio radius of a given node.  The average number of nodes within range of each node is known as network density.

Every network has its own application requirements, and thus there are many options for what statistics to examine for accessing the quality of locations.  The simplest criteria is to look at the mean location error across all nodes in the network.  For the most part, this is the basis for the results in this study.  However, this assumes that all nodes in the network must be used in the final results.  If the network designers know which nodes have poor locations, they may wish to exclude these nodes from the final results.  Therefore, if the economics of the network deployment allow, it may be beneficial to look at the best, for example, 80\% of nodes in the network.  In practice, the designers do not know which nodes to exclude, so this study also attempts to identify a correlation between a particular node's position relative to the anchor nodes and its localization error.  However, no such correlation was determined in our studies.

\section{Coordinate Transformation} \label{sec:procrustes}
To understand the various hypotheses for the best anchor placement, a basic understanding of how the transformation from local to global coordinate systems is required.  After the local networks have been calculated and patched together into a single cohesive network, the anchor nodes are then used. Using Procrustes~\cite{procrustes-matlab} analysis, a linear transformation of translation, reflection, orthogonal rotation, and scaling is determined for the anchor nodes from the calculated to known coordinates. The transformation is chosen by minimizing the sum of squared errors for the resulting coordinates.  Specifically, given real, measured coordinates and patched, calculated points, $Y$, for the anchors, Procrustes gives a transformation as shown in Equation~\ref{eqn:procrustes} that minimizes the difference between the real points and the transformed points, $Z$.  In the equation, $b$ is a scalar component, $T$ is the rotation/reflection component, and $c$ is the translation component.  The rotation/reflection component, $T$, is discussed in more detail in Section~\ref{sec:reflection}.

\begin{equation}\label{eqn:procrustes}
Z = b*Y*T + c \\
\end{equation}

For example, take a random anchor set, as shown in Figure~\ref{fig:sampleProcrustes1}.  The figure shows the three triangles, which are the patched, local coordinates, the real global coordinates, and the transformed coordinates after applying the calculated transformation from patched to real points.  The actual transformation equation is shown in Equation~\ref{eqn:sampleProcrustes1}.  This demonstrates that the transformation calculated by Procrustes is not perfect, as the real and transformed coordinates do not align exactly.

\begin{figure}
	\centering
		\includegraphics[width=\textwidth]{SampleAnchors}
	\caption{A sample anchor triangle Procrustes analysis}
	\label{fig:sampleProcrustes1}
\end{figure}

\begin{equation}\label{eqn:sampleProcrustes1}
\begin{bmatrix}$$Y$$\end{bmatrix}=1.589\begin{bmatrix}
	2.571   & 14.662 \\
   14.628   &  0.715 \\
    4.926   &  2.844\end{bmatrix}\begin{bmatrix}
	-0.662  & -0.749 \\
    0.749   & -0.662\end{bmatrix}+\begin{bmatrix}
16.7334 & 7.7612 \\
\vdots & \vdots$$\end{bmatrix}
\end{equation}

The transformation is then applied to all nodes in the network by simply replacing $Y$ in Equation~\ref{eqn:procrustes} with the patched, local coordinates for the entire network. Therefore, how well the anchor nodes mapping transform captures the overall calculated network variability dictates how good the final locations will be.

\section{Methodology}
For the purposes of testing each hypothesis, randomly generated networks of varying sizes are used.  Unless otherwise specified, all nodes are randomly placed within a square area with an overall density of one node per unit area.  For example, in a \emph{20x20} square area will have 400 randomly placed nodes.  Anchor sets are chosen by identifying all possible sets via \emph{n choose k}, where \emph{n} is the number of nodes in the network and \emph{k} is the number of nodes per anchor set.  For example, a \emph{20x20} network of 400 nodes, and three nodes per anchor set, there are a possible 10,586,800 choices.  From the total set of possible anchor sets, a random selection is made.  For the data in this chapter, 1,000 anchor sets are randomly chosen.  Choosing anchor sets from the \emph{n choose k} population excludes the possibility of choosing the same anchor set more than once.

To view all the Matlab\copyright code for simulations and plots see Appendix~\ref{AppendixA}.

\section{Anchor Node Placement Metrics}
\begin{figure}
	\centering
		\includegraphics[width=\textwidth]{network1}
	\caption[The sample network used in this chapter]{The sample network used in this chapter, showing connectivity between nodes}
	\label{fig:HypothesesNetwork}
\end{figure}

Almost as important as knowing which factors effect localization is knowing which factors to ignore. The following is a summary of hypotheses of anchor node placement factors that show no or little significant correlation to location error.  The data in the following graphs is taken from a random selection of 1000 anchor sets of three nodes each for the network shown in Figure~\ref{fig:HypothesesNetwork}.  The node placement is random within the 20 by 20 square unit area, and all nodes have a radio range of 2.5 units, providing a completely connected network.

\subsection{Anchor Node Error}
The first hypothesis is to choose nodes as anchors that we expect to have high location accuracy. Because we are trying to provide an a priori design technique for network planners, the information chosen to reach the goal must be something the network planner can determine before any localization has been performed.  For this purpose we choose the number of one-hop neighbors.  Since the range-free algorithms depend heavily on network connectivity, the theory is that nodes with more neighbors will have lower location errors.  The lower error in the anchors themselves should then translate into a more accurate transformation of the entire network.

\begin{figure}
  \centering
	\subfloat[All anchor sets]{\label{fig:Neighbors}
		\includegraphics[width=\figurewidth\textwidth]{numneighbors/AnchorNeighborsVsError}}
\\
	\subfloat[Excluding outliers]{\label{fig:NeighborsExcluding}
		\includegraphics[width=\figurewidth\textwidth]{numneighbors/AnchorNeighborsVsErrorExcluding}}
	\caption{Number of anchor neighbors vs location error}
	\label{fig:NumberOfAnchorNeighbors}
\end{figure}
\begin{figure}
  \centering
	\subfloat[All anchor sets]{\label{fig:AnchorError}
		\includegraphics[width=\figurewidth\textwidth]{numneighbors/AnchorSetErrorVsError}}
\\
	\subfloat[Excluding outliers]{\label{fig:AnchorErrorExcluding}
		\includegraphics[width=\figurewidth\textwidth]{numneighbors/AnchorSetErrorVsErrorExcluding}}		
	\caption{Mean of anchor node error vs location error}
	\label{fig:MeanAnchorError}
\end{figure}

Figure~\ref{fig:Neighbors} plots the sum of unique one-hop neighbors for all anchor nodes versus mean localization error.  The irregularity of the curve disproves the hypothesis. Further, the correlation coefficient, with 95\% confidence intervals, is extremely low, less than 0.1.  Based on these statistics, choosing anchors in denser parts of the network does not translate into better network-wide localization accuracy.

Further, we explore if having anchors with lower localization error translates into lower localization error across the network. Figure~\ref{fig:AnchorError} plots the mean error of the anchor nodes themselves versus the mean error for all nodes in the network. This essentially measures how well the transformation generated by Procrustes analysis matches the target.  The erratic plot and low correlation coefficient suggests there is no foundation for this hypothesis.  

In both plots, it is clear that a small subset of the anchor placements lead to far greater error than the norm.  Later, we will explore the cause of these outliers, but for the time being, we exclude them from the analysis as shown in Figure~\ref{fig:NeighborsExcluding} and Figure~\ref{fig:AnchorErrorExcluding}. Determining which data points are outliers is quite obvious since the gap between the normal case and the small set of outliers is distinct. Therefore, rather then using a statistical calculation for the exclusion, all anchor sets with mean location error greater than two are excluded.

Even after the outliers are excluded, no pattern emerges and the correlation coefficients remain extremely low.  Further, the line of best fit has a low r-squared value of 0.02.  Higher order best fits also show no clear correlation.

\subsection{Network Area Coverage}
\label{sec:anchorcoverage}
As suggested in related studies in Chapter~\ref{chap:RelatedWork}, an optimal anchor placement is to have the anchors as far apart as possible, around the edges of the network.  The rationale behind this hypothesis, in the context of this study, is that if a wider area of the network is covered by the anchor nodes, then the resulting calculated transformation will take into account more network variations.

One way to determine how close the anchors are to the perimeter of the network is to measure how far apart the anchors are from each other.  The further apart they are, they closer they are to the edge and the more network area they cover.  For statistical purposes, the sum of the distance between each pair of anchors is taken.  I describe this as the sum of distances of the anchors instead of the perimeter of the triangle formed because this hypothesis investigates if the further apart the anchors are from each makes a difference. Further, the sum of distances scales for the case of more than three anchor nodes, whereas the meaning of perimeter will change the desired description.  Figure~\ref{fig:SampleSumOfDistances} shows an example for both the three and four anchor node case.  For the three node case, it is equal to the perimeter of the triangle.  More generically, for more nodes, as shown here for four, it is the distance between each pair of nodes.

\begin{figure}
  \centering
    \includegraphics[width=\textwidth]{SampleSumOfDistances}
    \caption{Sum of Distances = $\sum_{i=0}^{n} \|x_{i}\| $}
	\label{fig:SampleSumOfDistances}
\end{figure}

Figure~\ref{fig:AnchorDistancesSum} shows the sum of distances between each anchors versus mean localization error for that anchor set. The plot shows that again there is low correlation between the distance between anchors and the location calculation.  Further, the outliers are spread relatively evenly regardless of distance between anchor nodes, and thus this is not a good indicator of an outlier.

\begin{figure}
  \centering
	\subfloat[All anchor sets]{\label{fig:AnchorDistancesSum}
		\includegraphics[width=\figurewidth\textwidth]{distances/SumAnchorDistanceVsError}}
\\
	\subfloat[Excluding outliers]{\label{fig:AnchorDistancesSumExcluding}
		\includegraphics[width=\figurewidth\textwidth]{distances/SumAnchorDistanceVsErrorExcluding}}
	\caption{Sum of distance between anchors vs location error}
    \label{fig:SumAnchorDistances}
\end{figure}
\begin{figure}
  \centering
	\subfloat[All anchor sets]{\label{fig:AnchorDistancesMinimum}
		\includegraphics[width=\figurewidth\textwidth]{distances/MinimumAnchorDistanceVsError}}
\\
	\subfloat[Excluding outliers]{\label{fig:AnchorDistancesMinimumExcluding}
		\includegraphics[width=\figurewidth\textwidth]{distances/MinimumAnchorDistanceVsErrorExcluding}}
	\caption{Minimum distance between anchors vs location error}
    \label{fig:MinAnchorDistances}
\end{figure}

When the outliers are excluded, as shown in Figure~\ref{fig:AnchorDistancesSumExcluding}, a moderate level of correlation is seen, with a much clearer line of best fit.  The only moderate, 0.48, correlation coefficient can be explained by the lower bound for location error.  There is a virtually straight line across the bottom of the data indicating that, at any distance between anchors, the lower bound of mean location error can be reached.  However, as the distance increases between the anchor nodes, the probability of getting a high location error decreases.

Even if the sum of distances of the anchors is high, it is possible for two anchors to be very close together and far from the third.  Therefore, the minimum distance between a pair of anchors is shown in Figure~\ref{fig:AnchorDistancesMinimum}.  Again, the correlation coefficient is low at 0.20.  However, it does appear that the outliers are slightly more likely to appear when the minimum distance between a pair of anchors is low.  Further, when outliers are excluded, as shown in Figure~\ref{fig:AnchorDistancesMinimumExcluding}, the coefficient is 0.32, slightly lower than that of the sum of the distances, implying that sum of the anchor distances is a better indicator of localization performance than minimum anchor distance.

\subsection{Anchor Node Triangle}
\label{sec:anchorTriangle}
Continuing the trend of trying to show some increased correlation between the anchor coverage and location error and based on speculative statements by Shang in \cite[p. 964]{MDS-MAP} presented in Section~\ref{sec:RelatedWorkEmpirical}, this section examines two additional metrics attempting to measure collinearity of the anchor nodes: the area and height of the anchor node triangle.  For height, we calculate the height in each direction of the triangle, and use the shortest value.  Both metrics can be extended to more anchor nodes.  Figure~\ref{fig:SampleHeights} shows a simple example of calculating the area and minimum height of a triangle.

\begin{figure}
  \centering
	\includegraphics[width=\textwidth]{SampleHeights}
	\caption[Area and height of a triangle]{Area and height of a triangle \\ 
	$Minimum~height~=~min(\| h_i \|)$}
	\label{fig:SampleHeights}
\end{figure}

Figure~\ref{fig:AnchorArea} plots the area of the triangle formed by the three anchor nodes versus mean location error.  This metric can also be extended to more anchor nodes, by using the area of the polygon formed by the anchor nodes.  Figure~\ref{fig:AnchorHeight} does the same for the shortest triangle height. The first observation from the two plots is that the outlier cases are more tightly correlated to anchor area and height than any of the other metrics, based on noticing that the outlier points are all closer to the y-axis rather then being spread across the plot. This is explored further in Section~\ref{sec:outlierindicators}.  Secondly, after removing outliers, the anchor area has a slightly higher correlation coefficient than anchor height, indicating that anchor area is a slightly better predictor than anchor height.

\begin{figure}
  \centering
	\subfloat[All anchor sets]{\label{fig:AnchorAreaAll}
		\includegraphics[width=\figurewidth\textwidth]{areas/AnchorAreaVsError}}
\\
	\subfloat[Excluding outliers]{\label{fig:AnchorAreaExcluding}
		\includegraphics[width=\figurewidth\textwidth]{areas/AnchorAreaVsErrorExcluding}}
	\caption{Area of anchor triangle vs location error}	
	\label{fig:AnchorArea}
\end{figure}

\begin{figure}
  \centering
	\subfloat[All points]{\label{fig:AnchorHeightAll}
		\includegraphics[width=\figurewidth\textwidth]{heights/AnchorHeightVsError}}
		\\
	\subfloat[Excluding outliers]{\label{fig:AnchorHeightExcluding}
		\includegraphics[width=\figurewidth\textwidth]{heights/AnchorHeightVsErrorExcluding}}
	\caption{Minimum height of anchor triangle vs location error}	
	\label{fig:AnchorHeight}
\end{figure}

\section{Best Anchor Node Placement}
\label{sec:bestanchornode}
Analyzing all the metrics discussed above, the best indicator of a good anchor placement is the sum of the distance between anchor nodes, once the outliers are excluded.  Avoiding the outlier case is discussed in Chapter~\ref{chap:outliers}.  Practically speaking, this means that network designers can choose between proposed anchor placements and use the measured distance between them to provide guidance about which placement will result in the least amount of error. 

Figure~\ref{fig:sumOfDistanceIndicator} uses data from 20 networks, each 20x20 units with a radio range of 2.5 units.  The networks have a density of one node per unit squared, but all nodes are randomly placed in each network.  5000 anchor sets of three nodes each are chosen from the randomly placed nodes.  The outliers are then removed from the data and the sum of distance between the anchors is plotted against the mean location error.  The data is then grouped into two-unit intervals and a mean is calculated for each interval.  A horizontal bar through the mean of each interval displays the width of that interval.  Further, a 95\% confidence interval is shown for each mean value.  

This plot shows us that as the sum of distances between the anchors approaches ten times the radio range, the differences in location error are statistically insignificant.  Therefore, network designers can place anchors for based on other factors as long as they meet this criteria.  The actual asymptote value depends on other factors, like network density and will be discussed further in Chapter~\ref{sec:otherfactors}.

\begin{figure}
  \centering
	\includegraphics[width=\textwidth]{SumOfDistanceIndicator_square}
	\caption[Sum of distance between anchors vs location error]{Sum of distance between anchors vs location error for 20 random square 20-by-20 unit networks with 400 nodes, 5000 anchor sets each, and a radio range of 2.5 units, excluding outliers}
	\label{fig:sumOfDistanceIndicator}
\end{figure}


